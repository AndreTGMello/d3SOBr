<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="lib/jquery/jquery.min.js"></script>
	<script src="lib/d3/d3.v3.min.js"></script>
	<script src="lib/d3SOBr.js"></script>
	<script src="d3sparql.js"></script>
	<link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.css"/>
	<script>
	function jsonTreemapzoom(){
  var endpoint = "http://cassidy.gpopai.usp.br:8209/OrcamentoGovernoEstadoSP/query?query="
  var prefix = "PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> \
	PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> \
	PREFIX owl: <http://www.w3.org/2002/07/owl#> \
	PREFIX dc: <http://purl.org/dc/elements/1.1/> \
	PREFIX dcterms: <http://purl.org/dc/terms/> \
	PREFIX foaf: <http://xmlns.com/foaf/0.1/> \
	PREFIX sim: <http://purl.org/ontology/similarity/> \
	PREFIX mo: <http://purl.org/ontology/mo/> \
	PREFIX ov: <http://open.vocab.org/terms/> \
	PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> \
	PREFIX bra: <http://www.semanticweb.org/ontologies/OrcamentoPublicoBrasileiro.owl/>"
  var sparql = prefix + " \
  SELECT ?tituloCategoriaEconomicaDaReceita ?tituloOrigem ?tituloEspecie (SUM(?valor) AS ?total) WHERE { \
  ?receita a bra:Receita .  \
  ?receita bra:valorArrecadado ?valor . \
  ?receita bra:temCategoriaEconomicaDaReceita ?categoriaEconomicaDaReceita . \
  ?categoriaEconomicaDaReceita dc:title ?tituloCategoriaEconomicaDaReceita . \
  ?receita bra:temOrigem ?origem . \
  ?origem dc:title ?tituloOrigem . \
  ?receita bra:temEspecie ?especie . \
  ?especie dc:title ?tituloEspecie . \
}GROUP BY ?tituloCategoriaEconomicaDaReceita ?tituloOrigem ?tituloEspecie ORDER BY ?tituloCategoriaEconomicaDaReceita ?tituloOrigem ?tituloEspecie DESC(?total)";
console.log("chamada jQuery")
  var uri = endpoint+encodeURI(sparql);
  $.getJSON( uri, function( response ) {
    console.log("jsonTreemapzoom response");
  console.log(response);
} );

	$( document ).ready(function() {
		console.log( "ready!" );
		//execBarrasOrgao(getAllPageParams());
		//execTabelaCategoriaEconomicaDaDespesa(getAllPageParams());
		//execTabelaGND(getAllPageParams());
		//execTabelaModalidadeDeAplicacao(getAllPageParams());
		//execTabelaElementoDeDespesa(getAllPageParams());
		execAllViz(getAllPageParams());
		console.log("Chamando jsonTreemapzoom");
		jsonTreemapzoom();
	});

	function toggleMunicipio(){
		if (document.getElementById("selectEstado").selectedIndex === 1)
			document.getElementById("selectMunicipio").disabled=true;
		else
			document.getElementById("selectMunicipio").disabled=false;
	}
	function montaMunicipios()
	{
		var listaMunicipios = pegaMunicipios();
		var lista = document.getElementById("selectMunicipio");
		console.log("entrei no montaMunicipios e a lista tem tamanho:");
		setTimeout(function(){
			console.log(listaMunicipios[0]);
			for(item in listaMunicipios){
			var opcao = document.createElement('option');
			opcao.value = listaMunicipios[item];
			opcao.innerHTML = listaMunicipios[item];
			lista.appendChild(opcao);
			}
		},2000);

	}
	window.onload = montaMunicipios;
	</script>
	<style>
	select:disabled{
		background: #dddddd;
	}

	.bar:hover {
		fill: brown;
	}
	</style>
	<style>
	text {
		pointer-events: none;
	}
	.children rect.parent,
	.grandparent rect {
		cursor: pointer;
	}
	.grandparent:hover rect {
		opacity: 0.8;
	}
	.children:hover rect.child {
		opacity: 0.2;
	}
	</style>
</head>
<body>
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner" style="padding-left: 20px">
			<br>
			<center>
				<button><i class="icon-th"></i><a href="index.html">Inicio</a></button>
				<button><i class="icon-th"></i><a href="paginaConsulta.html">Consultas</a></a></button>
			</center>
			<br>
		</div>
	</div>
	<div id="query" style="margin: 100px">
		<center><h1>Visualização de Orçamentos do Brasil</h1></center>

		<p>Escolha a origem dos dados:
			<select id="selectEstado" onchange="toggleMunicipio()">
				<option value="SP">
					Estado de São Paulo
				</option>
				<option value="Federal">
					Receitas e despesas do Governo Federal
				</option>
			</select>
		</p>
		<p>Escolha um município:
			<select id="selectMunicipio">
			</select>
		</p>

		<button onclick="reloadWithQueryStringVars({'origem':$('#selectEstado').val()})">ENVIAR DADOS</button>
	</div>
	<div id="graficoBarrasOrgao"></div>
	<div id="tabelaCategoriaEconomicaDaDespesa"></div>
	<div id="pizzaCategoriaEconomicaDaDespesa"></div>

	<div id="tabelaGND"></div>
	<div id="pizzaGND"></div>

	<div id="tabelaModalidadeDeAplicacao"></div>
	<div id="pizzaModalidadeDeAplicacao"></div>

	<div id="tabelaElementoDeDespesa"></div>
	<div id="pizzaElementoDeDespesa"></div>

	<div id="tabelaSubelemento"></div>

	<div id="mapa"></div>

</body>
</html>
